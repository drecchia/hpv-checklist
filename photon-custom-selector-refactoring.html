<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HpvCheckList Component</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0 auto;
        }
        /*  THIS IS TEST ONLY  */
        .hpv-checklist {
            width: 400px;
            border-style: solid;
            border-width: thin;
            border-radius: 8px;
        }
        .hpv-checklist ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .hpv-checklist li {
            color: #303438;
            padding: 5px 10px;
            font-size: 12px;
            text-align: left;
            line-height: 18px;
            font-weight: 400;
            cursor: pointer;
        }
        .hpv-checklist li:hover {
            background-color: #f3f3f3;
        }
        .hpv-checklist label {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
        }
        .hpv-checklist .hpv-checklist-content {
            overflow-y: auto;
            padding-top: 10px;
        }
        .hpv-checklist #root-container {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            flex-grow: 1;
            margin: 50px;
        }
        .hpv-checklist .search-container {
            position: relative;
            width: 100%;
        }
        .hpv-checklist .search-input {
            width: 100%;
            padding: 8px 30px 8px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .hpv-checklist .clear-search {
            position: absolute;
            right: 10px;
            top: 25%;
            height: 18px;
            background-color: #e3e3e3;
            border: 0;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            width: 18px;
        }
        .hpv-checklist .clear-search:hover {
            background-color: #ffacac;
        }
        .hpv-checklist .optgroup {
            font-weight: bold;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #e7e7e7;
            padding: 5px 10px;
            color: rgba(48, 52, 56, .7);
            cursor: default;
            margin: 9px 0 0 0;
            font-size: 14px;
            text-shadow: none;
            line-height: 20px;
        }
        .hpv-checklist .optgroup::before {
            content: '▼';
            display: inline-block;
            margin-right: 5px;
            transition: transform 0.3s;
        }
        .hpv-checklist .optgroup.collapsed::before {
            transform: rotate(-90deg);
        }
        .hpv-checklist .optgroup + ul {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 1000px;
            opacity: 1;
            overflow: hidden;
        }
        .hpv-checklist .optgroup.collapsed + ul {
            max-height: 0;
            opacity: 0;
        }
        .hpv-checklist .select-all-main.select-single-mode {
            display: none;
        }
        .hpv-checklist .select-all-group.select-single-mode {
            visibility: hidden;
        }
        .hpv-checklist .select-all-group {
            background: none;
            border: none;
            cursor: pointer;
            color: #2196F3;
            font-size: 12px;
            visibility: visible;
        }
        .hpv-checklist .hpv-checklist-btn-group button {
            background: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
        }
        .hpv-checklist .hpv-checklist-btn-group button:disabled {
            cursor: default;
            border-width: thin;
        }
        .hpv-checklist .hpv-checklist-btn-group button:not([disabled]) {
            border: 1px solid #2196F3;
            color: #2196F3;
        }
        .hpv-checklist .hpv-checklist-btn-group .select-all-main:not([disabled]):hover {
            background-color: #2196F3;
            color: white;
        }
        .hpv-checklist .hpv-checklist-status-container {
            display: flex;
            padding: 10px;
            justify-content: center;
            color: #a7a7a7;
        }
        .hpv-checklist .hpv-checklist-disabled {
            color: #ccc;
        }
        .hpv-checklist .hpv-checklist-btn-group {
            display: flex;
            justify-content: flex-start;
            gap: 20px;
            padding-left: 10px;
            padding-right: 10px;
        }

        .hpv-checklist .custom-checkbox {
            width: 15px;
            height: 15px;
            border: 2px solid #ccc;
            border-radius: 3px;
            display: inline-block;
            position: relative;
            cursor: pointer;
        }

        .hpv-checklist .custom-checkbox[data-checked="true"] {
            background-color: #2196F3;
            border-color: #2196F3;
        }

        .hpv-checklist .custom-checkbox[data-disabled="true"] {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .hpv-checklist .custom-checkbox[data-state="1"] {
            background-color: #2196F3;
            border-color: #2196F3;
        }

        .hpv-checklist .custom-checkbox[data-state="2"] {
            background-color: #FF0000;
            border-color: #FF0000;
        }

        .hpv-checklist .custom-checkbox[data-state="3"] {
            background-color: #b700ff;
            border-color: #b700ff;
        }

        .hpv-checklist .custom-checkbox[data-state="4"] {
            background-color: #0fb417;
            border-color: #0fb417;
        }

        .hpv-checklist .custom-checkbox .checkbox-inner {
            position: absolute;
            border: solid white;
            border-width: 0 2px 2px 0;
            width: 3px;
            height: 10px;
            top: 0px;
            left: 5px;
            transform: rotate(45deg);
            display: none;
        }

        .hpv-checklist .custom-checkbox[data-checked="true"] .checkbox-inner {
            display: block;
        }

        .hpv-checklist .checkbox-label {
            margin-left: 8px;
            cursor: pointer;
        }

        .hpv-checklist li {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
   <div id="checklist1"></div>

   <div style="display: flex;flex-direction: column;padding-top:50px;">
    <span>TODO:</span>
    <span>Single mode nao esta funcionando com states</span>
    <span>Max Nr of items</span>
    <span>Remove from list after click</span>
    <span>Not mandatory optgroups</span>
    <span>virtualscroll</span>
    <span>remote list</span>
    <span>focus search-input</span>
    <span>custom render list item</span>
    <span>Why renderItems and updateItemState, sounds redundancy</span>
   </div>

   <script>
class HpvCheckListError extends Error {
  constructor(message) {
    super(message);
    this.name = 'HpvCheckListError';
  }
};

class HpvCheckList {
    constructor(containerId, options = {}) {
        this.defaultOptions = {
            searchPlaceholder: "Search options...",
            selectAllMainText: "Select All Visible",
            selectAllGroupText: "Select All",
            clearSearchTooltip: "Clear Search",
            emptyText: "No items available",
            disabledText: "This item is disabled",
            selectMode: 'multiple',
            maxSelectableItems: 1000,
            states: [0, 1], // from 0 to 4
            onSelect: null,
            onDeselect: null,
            onSelectAll: null,
            onDeselectAll: null,
            onSelectGroup: null,
            onDeselectGroup: null,
            onCollapseGroup: null,
            onExpandGroup: null,
            onLocalSearchResult: null,
            onSearchInputDelay: null,
            onSearchInput: null,
            onClearSearch: null,
            onExclusionModeChange: null,
            items: [],
            disabledClass: 'hpv-checklist-disabled',
            fieldMap: {
                keyField: 'id',
                labelField: 'label',
                valueField: 'value',
                optgroupField: 'optgroup',
                disabledField: 'disabled',
            },
        };

        this.options = { ...this.defaultOptions, ...options };
        this.container = document.getElementById(containerId);
        this.containerId = containerId;

        // Initialize sub-modules
        this.ui = new UIModule(this);
        this.search = new SearchModule(this);
        this.items = new ItemsModule(this);
    }

    // global proxy for modules
    addItems(userItems) {
        if (!userItems || Array.isArray(userItems) === false) {
            throw new HpvCheckListError('Invalid items format');
        }

        this.items.addMultiple(userItems);
        this.ui.afterAddOrRemoveItems();
    }

    // global proxy for modules
    addItem(item, fireAfterChange = true) {
        if (!item || typeof item !== 'object') {
            throw new HpvCheckListError('Invalid item format');
        }

        this.items.add(item);

        if ( fireAfterChange ) {
            this.ui.afterAddOrRemoveItems();
        }
    }

    removeAllItems() {
        // we wont clear items, only delete el, keeping previous selected items on list
        this.items.removeAll();
        this.renderItems();
        this.setupItemsEventListeners();
        this.updateItemStates();

        this.ui.afterAddOrRemoveItems();
    }
    
    // checkItem(id, check = true) {
    //     const item = this.items.items.get(id);
    //     // Do not allow to change disabled items
    //     if ( item.nativeDisabled ) return;

    //     if (item) {
    //         item.value = check ? 1 : 0;
    //         this.items.items.set(id, item);
    //         // render items
    //         this.updateItemStates();
    //     } else {
    //         console.warn(`Item with id "${id}" not found`);
    //     }
    // }

    setItemVisibility(id, visible) {
        const item = this.items.items.get(id);
        if (item) {
            item.visible = visible;
            this.items.items.set(id, item);

            // style
            item.el.style.display = visible ? '' : 'none';
        }
    }

    renderItems() {
        const fragment = document.createDocumentFragment();
        const checkboxList = this.container.querySelector('.hpv-checklist-checkbox-list');
        checkboxList.innerHTML = '';

        const groupedItems = this.items.getGroupedItems();

        for (const [groupName, items] of Object.entries(groupedItems)) {
            const optgroup = document.createElement('div');
            optgroup.className = 'optgroup';
            optgroup.innerHTML = `
                <span>${groupName}</span>
                <button class="select-all-group ${this.options.selectMode == 'single' ? 'select-single-mode' : ''}">${this.options.selectAllGroupText}</button>
            `;

            optgroup.setAttribute('group-name', groupName);

            fragment.appendChild(optgroup);

            const ul = document.createElement('ul');
            items.forEach((item) => {
                const li = document.createElement('li');
                li.className = item.disabled ? this.options.disabledClass : '';
                li.innerHTML = `
                    <div class="custom-checkbox" id="${item.key}" ${item.disabled ? 'data-disabled' : ''} ${item.checkedInclusion ? 'data-checked' : ''}>
                        <div class="checkbox-inner"></div>
                    </div>
                    <div class="checkbox-label">${item.label}</div>
                `;
                ul.appendChild(li);

                item.el = li;
            });
            fragment.appendChild(ul);
        }

        checkboxList.appendChild(fragment);
    }

    // set attributes that css will use to style the items
    updateItemStates() {
        this.items.items.forEach((item, id) => {
            if ( !item.el ) return;

            const itemContainer = item.el;
            const customCheckbox = itemContainer.querySelector('.custom-checkbox');
            const label = itemContainer.querySelector('.checkbox-label');
            const isNativeDisabled = item.nativeDisabled;

            customCheckbox.setAttribute('data-checked', item.value !== this.options.states[0] ? 'true' : 'false');
            customCheckbox.setAttribute('data-state', item.value.toString());

            if (isNativeDisabled) {
                customCheckbox.setAttribute('data-disabled', 'true');
            } else {
                customCheckbox.removeAttribute('data-disabled');
            }

            itemContainer.classList.toggle(this.options.disabledClass, isNativeDisabled);

            if (customCheckbox.hasAttribute('data-disabled')) {
                label.title = isNativeDisabled ? this.options.disabledText : '';
            } else {
                label.title = '';
            }
        });
    }

    setupItemsEventListeners() {
        this.setupCollapsibleOptgroups();
        this.setupClickableListItems();
    }

    itemMatchesFilter(item, lowerFilter) {
        return item.label.toLowerCase().includes(lowerFilter) || 
            item.optgroup.toLowerCase().includes(lowerFilter);
    }

    setupCollapsibleOptgroups() {
        const optgroups = this.container.querySelectorAll('.optgroup');
        for (let group of optgroups) {
            const groupName = this.getGroupName(group);

            group.addEventListener('click', (e) => {
                if (e.target.tagName.toLowerCase() === 'button') return;
                const isCollapsing = !group.classList.contains('collapsed');
                group.classList.toggle('collapsed');
                const ul = group.nextElementSibling;
                if (ul.tagName.toLowerCase() === 'ul') {
                    ul.style.display = isCollapsing ? 'none' : '';
                }
                const selectAllBtn = group.querySelector('.select-all-group');
                selectAllBtn.style.visibility = isCollapsing ? 'hidden' : 'visible';

                if (isCollapsing && this.options.onCollapseGroup) {
                    this.options.onCollapseGroup(groupName, group, this.getItemsByGroup(groupName));
                } else if (!isCollapsing && this.options.onExpandGroup) {
                    this.options.onExpandGroup(groupName, group, this.getItemsByGroup(groupName));
                }
            });
        }
    }

    setupClickableListItems() {
        const listItems = this.container.querySelectorAll('li');
        listItems.forEach(item => {
            item.addEventListener('click', (e) => {
                const customCheckbox = item.querySelector('.custom-checkbox');
                if (!customCheckbox.hasAttribute('data-disabled')) {
                    this.toggleItemSelection(customCheckbox.id);
                    e.preventDefault();
                }
            });
        });
    }

    toggleItemSelection(id) {
        const item = this.items.items.get(id);
        if (!item || item.nativeDisabled) return;

        const currentStateIndex = this.options.states.indexOf(item.value);
        const nextStateIndex = (currentStateIndex + 1) % this.options.states.length;
        item.value = this.options.states[nextStateIndex];

        if (this.options.selectMode === 'single') {
            this.items.items.forEach((otherItem, otherId) => {
                if (otherId !== id) {
                    otherItem.value = this.options.states[0]; // First state is always unselected
                }
            });
        }

        this.updateItemStates();

        if (item.value !== this.options.states[0] && this.options.onSelect) {
            this.options.onSelect(id, item);
        } else if (item.value === this.options.states[0] && this.options.onDeselect) {
            this.options.onDeselect(id, item);
        }
    }

    getItemsByGroup(groupName) {
        // find in this.items items where item.optgroup = groupName
        return Array.from(this.items.items.values()).filter(item => item.optgroup === groupName);
    }

    getGroupName(groupEl) {
        return groupEl.getAttribute('group-name');
    }

    selectAllGroup(button) {
        if (this.options.selectMode === 'single') return;

        const group = button.closest('.optgroup');
        const groupName = this.getGroupName(group);
        const items = this.getItemsByGroup(groupName);
        const newValue = this.goToNextState(items);

        if (newValue !== this.options.states[0] && this.options.onSelectGroup) {
            this.options.onSelectGroup(groupName, this.items.getSelectedItems());
        } else if (newValue === this.options.states[0] && this.options.onDeselectGroup) {
            this.options.onDeselectGroup(groupName, this.items.items);
        }
    }

    goToNextState(items) {
        const currentState = this.getItemsState(items);
        const nextStateIndex = (this.options.states.indexOf(currentState) + 1) % this.options.states.length;
        const newValue = this.options.states[nextStateIndex];

        items.forEach(item => {
            if (!item.nativeDisabled) {
                item.value = newValue;
            }
        });

        this.updateItemStates();

        return newValue;
    }

    // determine the state of the items
    getItemsState(items) {
        const states = items
            .filter(item => !item.nativeDisabled)
            .map(item => item.value);
        
        if (states.every(state => state === states[0])) {
            return states[0];
        }
        return this.options.states[0]; // Default to first state if mixed
    }

    selectAllMain() {
        if (this.options.selectMode === 'single') return;

        const visibleItemsWithoutDisabled = this.items.getVisibleItems( false );
        const newValue = this.goToNextState(visibleItemsWithoutDisabled);

        if (newValue > 0 && this.options.onSelectAll) {
            this.options.onSelectAll(visibleItemsWithoutDisabled.map(item => item.key), this.items.getSelectedItems());
        } else if (newValue === 0 && this.options.onDeselectAll) {
            this.options.onDeselectAll(visibleItemsWithoutDisabled.map(item => item.key), this.items.getSelectedItems());
        }
    }
};

class ItemsModule {
    constructor(p) {
        if (!(p instanceof HpvCheckList)) {
            throw new HpvCheckListError('Parent must be an instance of HpvCheckList');
        }

        this.parent = p;
        this.items = new Map(); // Store all items { id, el, internal } with their states
    }

    getVisibleItems( includeDisabled = true ) {
        // return all items where item.visible = true and item.disabled = false
        return Array.from(this.items.entries())
            .filter(([_, item]) => item.visible && (includeDisabled || !item.nativeDisabled))
            .map(([_, item]) => item);
    }

    // to item module
    getSelectedItems() {
        // list all entries from this.items where (item.value > 0)
        return Array.from(this.items.entries())
            .filter(([_, item]) => item.value > 0)
            .map(([_, item]) => item);
    }

    // to item module
    getSelectedIds() {
        return Array.from(this.items.entries())
            .filter(([_, item]) => item.value > 0)
            .map(([id, _]) => id);
    }

    addMultiple(userItems) {
        userItems.forEach(item => this.add(item, false));
    }

    add(item, fireAfterChange = true) {
        const { keyField, labelField, valueField, disabledField, optgroupField } = this.parent.options.fieldMap;

        const key = item[keyField] + ''; // protection
        const label = item[labelField];
        const value = item[valueField] || 0;
        const optgroup = item[optgroupField];
        const disabled = item[disabledField] || false;

        this.items.set(key, {
            key: key,
            label: label,
            value: value,
            optgroup: optgroup,
            disabled: disabled,
            // internal
            nativeDisabled: disabled,
            visible: true,
        });

        if ( fireAfterChange ) {
            this.parent.ui.afterAddOrRemoveItems();
        }
    }

    remove(id) {
        if (this.items.has(id)) {
            this.items.delete(id);
            return true;
        }

        return false;
    }

    removeAll( keepSelectedStates = true ) {
        // NOTE: will we really remove all items or delete el from DOM?
        this.items.clear();
    }

    getGroupedItems() {
        const groups = {};
        
        this.items.forEach(item => {
            if (!groups[item.optgroup]) {
                groups[item.optgroup] = [];
            }
            groups[item.optgroup].push(item);
        });

        return groups;
    }

    getSize() {
        return this.items.size;
    }
};

class SearchModule {
    constructor(p) {
        if (!(p instanceof HpvCheckList)) {
            throw new HpvCheckListError('Parent must be an instance of HpvCheckList');
        }

        this.parent = p;
        this.timeout = null;
        this.setupSearchInput();
        this.setupClearSearchButton();
        this.setupSearchInputShortcut();
    }

    setupSearchInput() {
        const searchInput = this.parent.container.querySelector('.search-input');
        
        searchInput.addEventListener('input', () => {
            const value = searchInput.value;
            const selectedItems = this.parent.items.getSelectedItems();

            if (this.parent.options.onSearchInputDelay) {
                clearTimeout(this.timeout);

                this.timeout = setTimeout(() => {
                    this.parent.options.onSearchInputDelay(value, selectedItems);
                }, 200);
            }

            if (this.parent.options.onSearchInput) {
                this.parent.options.onSearchInput(value, selectedItems);
            }

            this.performLocalSearch(value);
        });
    }

    setupClearSearchButton() {
        const clearButton = this.parent.container.querySelector('.clear-search');
        clearButton.addEventListener('click', () => this.clearSearch());
    }

    setupSearchInputShortcut() {
        const searchInput = this.parent.container.querySelector('.search-input');
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();

                if ( e.shiftKey && this.parent.options.states.includes(2) ) {
                    this.toggleVisibleItems(2);
                } else {
                    this.toggleVisibleItems(1);
                }
                this.clearSearch();
            }
        });
    }

    toggleVisibleItems(targetState) {
        const visibleItems = Array.from(this.parent.items.items.entries())
            .filter(([_, item]) => item.visible && !item.nativeDisabled);

        const allInTargetState = visibleItems.every(([_, item]) => item.value === targetState);

        const newState = allInTargetState ? this.parent.options.states[0] : targetState;

        visibleItems.forEach(([id, item]) => {
            this.parent.items.items.get(id).value = newState;
        });

        this.parent.updateItemStates();

        if (newState === this.parent.options.states[0]) {
            if (this.parent.options.onDeselectAll) {
                this.parent.options.onDeselectAll(
                    visibleItems.map(([id, _]) => id),
                    this.parent.items.getSelectedItems()
                );
            }
        } else {
            if (this.parent.options.onSelectAll) {
                this.parent.options.onSelectAll(
                    visibleItems.map(([id, _]) => id),
                    this.parent.items.getSelectedItems()
                );
            }
        }
    }

    clearSearch() {
        const searchInput = this.parent.container.querySelector('.search-input');
        searchInput.value = '';
        searchInput.dispatchEvent(new Event('input'));
        if (this.parent.options.onClearSearch) {
            this.parent.options.onClearSearch(this.parent.items.getSelectedItems());
        }
    }

    performLocalSearch(filter) {
        const lowerFilter = filter.toLowerCase();
        const optgroups = this.parent.container.querySelectorAll('.optgroup');
        let visibleItemsCount = 0;

        this.parent.items.items.forEach((item, id) => {
            const visible = this.parent.itemMatchesFilter(item, lowerFilter);
            this.parent.setItemVisibility(id, visible);
            if (visible) visibleItemsCount++;
        });

        optgroups.forEach(group => {
            const groupName = group.getAttribute('group-name');
            const groupItems = this.parent.getItemsByGroup(group);
            const visibleGroupItems = groupItems.filter(item => item.visible);
            
            if (visibleGroupItems.length > 0 || groupName.toLowerCase().includes(lowerFilter)) {
                group.style.display = '';
                group.classList.remove('collapsed');
                const ul = group.nextElementSibling;
                if (ul && ul.tagName.toLowerCase() === 'ul') {
                    ul.style.display = '';
                }
            } else {
                group.style.display = 'none';
            }
        });

        if (visibleItemsCount === 0) {
            this.parent.ui.showEmptyStatus();
        } else {
            this.parent.ui.hideStatus();
        }

        if (this.parent.options.onLocalSearchResult) {
            this.parent.options.onLocalSearchResult(filter, this.parent.items.getSelectedItems());
        }

        // this.updateItemStates();
    }

    // ... (other search-related methods)
};

class UIModule {
    constructor(p) {
        if (!(p instanceof HpvCheckList)) {
            throw new HpvCheckListError('Parent must be an instance of HpvCheckList');
        }
        
        this.parent = p;
        this.createDropdownContainer();
        // select all button and group buttons ( by Event Target )
        this.setupSelectAllButtons();
    }

    afterAddOrRemoveItems() {
        if ( this.parent.items.getSize() == 0 ) {
            this.showCustomStatus(this.options.emptyText);
        } else {
            this.hideStatus();
        }

        // only when items are added after init
        this.parent.renderItems();
        this.parent.setupItemsEventListeners();
        this.parent.updateItemStates();
    }

    showEmptyStatus() {
        this.showCustomStatus(this.parent.options.emptyText);
    }

    showCustomStatus(htmlContent) {
        const statusContainer = this.parent.container.querySelector('.hpv-checklist-status-container');
        statusContainer.querySelector('span').innerHTML = htmlContent;
        statusContainer.style.display = 'flex';
    }

    hideStatus() {
        this.parent.container.querySelector('.hpv-checklist-status-container').style.display = 'none';
    }

    setupSelectAllButtons() {
        this.parent.container.addEventListener('click', (e) => {
            if (e.target.matches('.select-all-group')) {
                this.parent.selectAllGroup(e.target);
            } else if (e.target.matches('.select-all-main')) {
                this.parent.selectAllMain();
            }
        });
    }

    createDropdownContainer() {
        // set class hpv-checklist to this.container
        this.parent.container.classList.add('hpv-checklist');
        const { searchPlaceholder, clearSearchTooltip, selectAllMainText, emptyText, selectMode } = this.parent.options;

        const dropdownHTML = `
            <div class="search-container">
                <input type="text" class="search-input" placeholder="${searchPlaceholder}">
                <button class="clear-search" title="${clearSearchTooltip}">&times;</button>
            </div>
            <div class="hpv-checklist-content">
                <div class="hpv-checklist-btn-group">
                    <button class="select-all-main ${selectMode == 'single' ? 'select-single-mode' : ''}">${selectAllMainText}</button>
                </div>
                <div class="hpv-checklist-status-container">
                    <span>${emptyText}</span>    
                </div>
                <div class="hpv-checklist-checkbox-list"></div>
            </div>
        `;

        // Append the HTML to the desired parent element
        this.parent.container.innerHTML += dropdownHTML;
    }
};

var scope = {};
document.addEventListener('DOMContentLoaded', () => {
    const checklist1 = new HpvCheckList('checklist1', {
        searchPlaceholder: "Buscar por...",
        selectAllMainText: "Selec. Todos Visíveis",
        selectAllGroupText: "Selec. Grupo",
        clearSearchTooltip: "Limpar a Busca",
        emptyText: "Nenhum item disponível",
        disabledText: "Este item está desabilitado",
        selectMode: 'multiple', // 'single' or 'multiple'
        states: [0, 1, 2, 3, 4],
        maxSelectableItems: 1000,
        onSelect: (id, item) => console.log('Selected:', id, item),
        onDeselect: (id, item) => console.log('Deselected:', id, item),
        onSelectGroup: (groupName, items) => console.log('Selected group:', groupName, items),
        onDeselectGroup: (groupName, items) => console.log('Deselected group:', groupName, items),
        onCollapseGroup: (groupName, group, groupItems) => console.log('Collapsed group:', groupName, group, groupItems),
        onExpandGroup: (groupName, group, groupItems) => console.log('Expanded group:', groupName, group, groupItems),

        onSelectAll: (checkboxes, previousSelected) => console.log('Selected all:', checkboxes.map(cb => cb.id), 'Previous:', previousSelected),
        onDeselectAll: (checkboxes, previousSelected) => console.log('Deselected all:', checkboxes.map(cb => cb.id), 'Previous:', previousSelected),
        onLocalSearchResult: (searchTerm) => console.log('Search completed for term:', searchTerm),
        onSearchInputDelay: (searchTerm) => console.log('Delayed search for:', searchTerm),
        onClearSearch: () => console.log('Search cleared'),
    });

    const items = [
        { id: 1, label: 'Apple', optgroup: 'Fruits', value: 1 },
        { id: 2, label: 'Banana', optgroup: 'Fruits', disabled: true },
        { id: 3, label: 'Cherry', optgroup: 'Fruits', value: 2 },
        { id: 10, label: 'Carrot', optgroup: 'Vegetables', value: 3 },
        { id: 11, label: 'Broccoli', optgroup: 'Vegetables' },
        { id: 12, label: 'Spinach', optgroup: 'Vegetables' },
        { id: 20, label: 'Gol Gti 1.0', optgroup: 'Cars' },
        { id: 21, label: 'Fiat Palio V8', optgroup: 'Cars' },
        { id: 22, label: 'Camaro Bubblebee', optgroup: 'Cars' },
    ];

    checklist1.addItems(items);

    checklist1.addItem({ 'id': 4, 'label': 'Abacaxi', 'optgroup': 'Fruits' });
    // checklist1.removeAllItems();

    scope.checklist1 = checklist1;

    console.log('Dropdown 1 selected items:', checklist1.items.getSelectedItems());
    // console.log('Dropdown 2 selected items:', dropdown2.getSelectedItems());

    // Example usage:
    // checklist1.checkItem('1', scope.checklist1.MODE_INCLUSION, false);

    console.log('Dropdown 1 selected IDs:', checklist1.items.getSelectedIds());
    // console.log('Dropdown 2 selected IDs:', dropdown2.items.getSelectedIds());
});
   </script>
</body>
</html>