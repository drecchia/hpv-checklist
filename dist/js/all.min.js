class HpvCheckListError extends Error{constructor(t){super(t),this.name="HpvCheckListError"}}class HpvCheckList{constructor(t,e={}){this.defaultOptions={searchPlaceholder:"Search options...",selectAllMainText:"Select All Visible",selectAllGroupText:"Select All",clearSearchTooltip:"Clear Search",emptyText:"No items available",disabledText:"This item is disabled",defaultOptGroupText:"Default",selectMode:"multiple",maxSelectableItems:1e3,states:[0,1],onSelect:null,onDeselect:null,onSelectAll:null,onDeselectAll:null,onSelectGroup:null,onDeselectGroup:null,onCollapseGroup:null,onExpandGroup:null,onLocalSearchResult:null,onSearchInputDelay:null,onSearchInput:null,onClearSearch:null,onExclusionModeChange:null,items:[],disabledClass:"hpv-checklist-disabled",fieldMap:{keyField:"id",labelField:"label",valueField:"value",optgroupField:"optgroup",disabledField:"disabled"}},this.options={...this.defaultOptions,...e},this.container=document.getElementById(t),this.containerId=t,this.ui=new UIModule(this),this.search=new SearchModule(this),this.items=new ItemsModule(this)}addItems(t){if(!t||!1===Array.isArray(t))throw new HpvCheckListError("Invalid items format");this.items.addMultiple(t),this.ui.afterAddOrRemoveItems()}addItem(t,e=!0){if(!t||"object"!=typeof t)throw new HpvCheckListError("Invalid item format");this.items.add(t),e&&this.ui.afterAddOrRemoveItems()}removeItem(t){const e=this.items.items.get(t);e&&e.el&&(e.hiddenBySelection=!0,e.el.classList.add("fade-out"),setTimeout(()=>{this.items.remove(t),this.ui.afterAddOrRemoveItems()},300))}removeAllItems(){this.items.removeAll(),this.ui.afterAddOrRemoveItems()}setItemVisibility(t,e,s){const i=this.items.items.get(t);i&&(i[e]=s,this.items.items.set(t,i),i.el.style.display=s?"":"none")}renderItems(){const{defaultOptGroupText:t,selectMode:e,selectAllGroupText:s,disabledClass:i}=this.options,o=document.createDocumentFragment(),n=this.container.querySelector(".hpv-checklist-checkbox-list");n.innerHTML="";const a=this.items.getGroupedItems(),l=this.items.getGroupNames().length;for(const[n,r]of Object.entries(a)){if(n==t&&1==l){const t=document.createElement("hr");t.className="hr-no-optgroups",o.appendChild(t)}else{const t=document.createElement("div");t.className="optgroup",t.innerHTML=`\n\t\t\t\t\t<span>${n}</span>\n\t\t\t\t\t<button class="select-all-group ${"single"==e?"select-single-mode":""}">${s}</button>\n\t\t\t\t`,t.setAttribute("group-name",n),o.appendChild(t)}const a=document.createElement("ul");r.forEach(t=>{const e=document.createElement("li");e.className=t.disabled?i:"",e.innerHTML=`\n\t\t\t\t\t<div class="custom-checkbox" id="${t.key}" ${t.disabled?"data-disabled":""} ${t.checkedInclusion?"data-checked":""}>\n\t\t\t\t\t\t<div class="checkbox-inner"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="checkbox-label">${t.label}</div>\n\t\t\t\t`,a.appendChild(e),t.el=e}),o.appendChild(a)}n.appendChild(o)}updateItemStates(){this.items.items.forEach((t,e)=>{if(!t.el)return;const s=t.el,i=s.querySelector(".custom-checkbox"),o=s.querySelector(".checkbox-label"),n=t.nativeDisabled;i.setAttribute("data-checked",t.value!==this.options.states[0]?"true":"false"),i.setAttribute("data-state",t.value.toString()),n?i.setAttribute("data-disabled","true"):i.removeAttribute("data-disabled"),s.classList.toggle(this.options.disabledClass,n),i.hasAttribute("data-disabled")?o.title=n?this.options.disabledText:"":o.title=""})}setupItemsEventListeners(){this.setupCollapsibleOptgroups(),this.setupClickableListItems()}itemMatchesFilter(t,e){return t.label.toLowerCase().includes(e)||t.optgroup.toLowerCase().includes(e)}setupCollapsibleOptgroups(){const t=this.container.querySelectorAll(".optgroup");for(let e of t){const t=this.getGroupName(e);e.addEventListener("click",s=>{if("button"===s.target.tagName.toLowerCase())return;const i=!e.classList.contains("collapsed");e.classList.toggle("collapsed");const o=e.nextElementSibling;"ul"===o.tagName.toLowerCase()&&(o.style.display=i?"none":""),e.querySelector(".select-all-group").style.visibility=i?"hidden":"visible",i&&this.options.onCollapseGroup?this.options.onCollapseGroup(this,t,e,this.getItemsByGroup(t)):!i&&this.options.onExpandGroup&&this.options.onExpandGroup(this,t,e,this.getItemsByGroup(t))})}}setupClickableListItems(){this.container.querySelectorAll("li").forEach(t=>{t.addEventListener("click",e=>{const s=t.querySelector(".custom-checkbox");s.hasAttribute("data-disabled")||(this.toggleItemSelection(s.id),e.preventDefault())})})}toggleItemSelection(t){const e=this.items.items.get(t);if(!e||e.nativeDisabled)return;const s=(this.options.states.indexOf(e.value)+1)%this.options.states.length;e.value=this.options.states[s],"single"===this.options.selectMode&&this.items.items.forEach((e,s)=>{s!==t&&(e.value=this.options.states[0])}),this.updateItemStates(),e.value!==this.options.states[0]&&this.options.onSelect?this.options.onSelect(this,t,e):e.value===this.options.states[0]&&this.options.onDeselect&&this.options.onDeselect(this,t,e)}getItemsByGroup(t){return Array.from(this.items.items.values()).filter(e=>e.optgroup===t)}getGroupName(t){return t.getAttribute("group-name")}selectAllGroup(t){if("single"===this.options.selectMode)return;const e=t.closest(".optgroup"),s=this.getGroupName(e),i=this.getItemsByGroup(s),o=this.goToNextState(i);o!==this.options.states[0]&&this.options.onSelectGroup?this.options.onSelectGroup(this,s,e,i):o===this.options.states[0]&&this.options.onDeselectGroup&&this.options.onDeselectGroup(this,s,e,i)}goToNextState(t){const e=this.getItemsState(t),s=(this.options.states.indexOf(e)+1)%this.options.states.length,i=this.options.states[s];return t.forEach(t=>{t.nativeDisabled||(t.value=i)}),this.updateItemStates(),i}getItemsState(t){const e=t.filter(t=>!t.nativeDisabled).map(t=>t.value);return e.every(t=>t===e[0])?e[0]:this.options.states[0]}selectAllMain(){if("single"===this.options.selectMode)return;const t=this.items.getVisibleItems(!1),e=this.goToNextState(t);e>0&&this.options.onSelectAll?this.options.onSelectAll(this,t):0===e&&this.options.onDeselectAll&&this.options.onDeselectAll(this,t)}}class ItemsModule{constructor(t){if(!(t instanceof HpvCheckList))throw new HpvCheckListError("Parent must be an instance of HpvCheckList");this.parent=t,this.items=new Map}getVisibleItems(t=!0){return Array.from(this.items.entries()).filter(([e,s])=>s.visibleAfterSearch&&(t||!s.nativeDisabled)).map(([t,e])=>e)}getSelectedItems(){return Array.from(this.items.entries()).filter(([t,e])=>e.value>0).map(([t,e])=>e)}getSelectedIds(){return Array.from(this.items.entries()).filter(([t,e])=>e.value>0).map(([t,e])=>t)}getGroupNames(){return Array.from(new Set(Array.from(this.items.values()).map(t=>t.optgroup)))}addMultiple(t){t.forEach(t=>this.add(t,!1))}add(t,e=!0){const{defaultOptGroupText:s,fieldMap:i}=this.parent.options,{keyField:o,labelField:n,valueField:a,disabledField:l,optgroupField:r}=i,c=t[o]+"",p=t[n];let h=t[a]||0;const u=t[r]||s,d=t[l]||!1;this.parent.options.states.includes(h)||(h=this.parent.options.states[0]),this.items.set(c,{key:c,label:p,value:h,optgroup:u,disabled:d,nativeDisabled:d,visibleAfterSearch:!0}),e&&this.parent.ui.afterAddOrRemoveItems()}remove(t){return!!this.items.has(t)&&(this.items.delete(t),!0)}removeAll(t=!0){this.items.clear()}getGroupedItems(){const t={};return this.items.forEach(e=>{t[e.optgroup]||(t[e.optgroup]=[]),t[e.optgroup].push(e)}),t}getSize(){return this.items.size}}class SearchModule{constructor(t){if(!(t instanceof HpvCheckList))throw new HpvCheckListError("Parent must be an instance of HpvCheckList");this.parent=t,this.timeout=null,this.setupSearchInput(),this.setupClearSearchButton(),this.setupSearchInputShortcut()}setupSearchInput(){const t=this.parent.container.querySelector(".search-input");t.addEventListener("input",()=>{const e=t.value,s=this.parent.items.getSelectedItems();this.parent.options.onSearchInputDelay&&(clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.parent.options.onSearchInputDelay(e,s)},200)),this.parent.options.onSearchInput&&this.parent.options.onSearchInput(e,s),this.performLocalSearch(e)})}setupClearSearchButton(){this.parent.container.querySelector(".clear-search").addEventListener("click",()=>this.clearSearch())}setupSearchInputShortcut(){this.parent.container.querySelector(".search-input").addEventListener("keydown",t=>{"Enter"===t.key&&(t.preventDefault(),t.shiftKey&&this.parent.options.states.includes(2)?this.toggleVisibleItems(2):this.toggleVisibleItems(1),this.clearSearch())})}toggleVisibleItems(t){const e=Array.from(this.parent.items.items.entries()).filter(([t,e])=>e.visibleAfterSearch&&!e.nativeDisabled),s=e.every(([e,s])=>s.value===t)?this.parent.options.states[0]:t;e.forEach(([t,e])=>{this.parent.items.items.get(t).value=s}),this.parent.updateItemStates(),s===this.parent.options.states[0]?this.parent.options.onDeselectAll&&this.parent.options.onDeselectAll(this.parent,e):this.parent.options.onSelectAll&&this.parent.options.onSelectAll(this.parent,e)}clearSearch(){const t=this.parent.container.querySelector(".search-input");t.value="",t.dispatchEvent(new Event("input")),this.parent.options.onClearSearch&&this.parent.options.onClearSearch(this.parent.items.getSelectedItems())}performLocalSearch(t){const e=t.toLowerCase(),s=this.parent.container.querySelectorAll(".optgroup");let i=0;this.parent.items.items.forEach((t,s)=>{const o=this.parent.itemMatchesFilter(t,e);this.parent.setItemVisibility(s,"visibleAfterSearch",o),o&&i++}),s.forEach(t=>{const s=t.getAttribute("group-name");if(this.parent.getItemsByGroup(s).filter(t=>t.visibleAfterSearch).length>0||s.toLowerCase().includes(e)){t.style.display="",t.classList.remove("collapsed");const e=t.nextElementSibling;e&&"ul"===e.tagName.toLowerCase()&&(e.style.display="")}else t.style.display="none"}),0===i?this.parent.ui.showEmptyStatus():this.parent.ui.hideStatus(),this.parent.options.onLocalSearchResult&&this.parent.options.onLocalSearchResult(t,this.parent.items.getSelectedItems())}}class UIModule{constructor(t){if(!(t instanceof HpvCheckList))throw new HpvCheckListError("Parent must be an instance of HpvCheckList");this.parent=t,this.createDropdownContainer(),this.setupSelectAllButtons()}afterAddOrRemoveItems(){0==this.parent.items.getSize()?this.showCustomStatus(this.parent.options.emptyText):this.hideStatus(),this.parent.renderItems(),this.parent.setupItemsEventListeners(),this.parent.updateItemStates()}showEmptyStatus(){this.showCustomStatus(this.parent.options.emptyText)}showCustomStatus(t){const e=this.parent.container.querySelector(".hpv-checklist-status-container");e.querySelector("span").innerHTML=t,e.style.display="flex"}hideStatus(){this.parent.container.querySelector(".hpv-checklist-status-container").style.display="none"}setupSelectAllButtons(){this.parent.container.addEventListener("click",t=>{t.target.matches(".select-all-group")?this.parent.selectAllGroup(t.target):t.target.matches(".select-all-main")&&this.parent.selectAllMain()})}createDropdownContainer(){this.parent.container.classList.add("hpv-checklist");const{searchPlaceholder:t,clearSearchTooltip:e,selectAllMainText:s,emptyText:i,selectMode:o}=this.parent.options,n=`\n\t\t\t<div class="search-container">\n\t\t\t\t<input type="text" class="search-input" placeholder="${t}">\n\t\t\t\t<button class="clear-search" title="${e}">&times;</button>\n\t\t\t</div>\n\t\t\t<div class="hpv-checklist-content">\n\t\t\t\t<div class="hpv-checklist-btn-group">\n\t\t\t\t\t<button class="select-all-main ${"single"==o?"select-single-mode":""}">${s}</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="hpv-checklist-status-container">\n\t\t\t\t\t<span>${i}</span>    \n\t\t\t\t</div>\n\t\t\t\t<div class="hpv-checklist-checkbox-list"></div>\n\t\t\t</div>\n\t\t`;this.parent.container.innerHTML+=n}}